<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Shenwang Admin - ตั้งค่าปิดปรับปรุง</title>
    <script type="module">
        // Import Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

        // เชื่อม Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyC3CZEV1yVSKa9MsO70B7usSVQiwJ1FwbI",
            authDomain: "shenwang-admin.firebaseapp.com",
            projectId: "shenwang-admin",
            storageBucket: "shenwang-admin.firebasestorage.app",
            messagingSenderId: "94650883832",
            appId: "1:94650883832:web:f1423799237e5a44c9a50d"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ดึง Element
        const statusText = document.getElementById('statusText');
        const toggleButton = document.getElementById('toggleButton');

        let isMaintenance = false;

        async function loadStatus() {
            const docRef = doc(db, "settings", "maintenance");
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                const data = docSnap.data();
                isMaintenance = data.isMaintenance;
                updateStatusText();
            } else {
                console.log("ไม่มีข้อมูล maintenance ในฐานข้อมูล");
            }
        }

        function updateStatusText() {
            statusText.textContent = isMaintenance ? "กำลังปิดปรับปรุง" : "ออนไลน์ตามปกติ";
        }

        async function toggleStatus() {
            isMaintenance = !isMaintenance;
            updateStatusText();

            const docRef = doc(db, "settings", "maintenance");
            await setDoc(docRef, {
                isMaintenance: isMaintenance,
                lastUpdate: new Date().toISOString(),
                updatedBy: "Admin" // หรือเปลี่ยนเป็นชื่อ Admin ที่ Login ก็ได้
            });

            alert('อัปเดตสถานะเรียบร้อยแล้ว');
        }

        toggleButton.addEventListener('click', toggleStatus);

        // โหลดสถานะตอนเปิดหน้า
        loadStatus();
    </script>
</head>
<body>
    <h2>ตั้งค่าปิดปรับปรุงเว็บไซต์</h2>
    <label>สถานะปัจจุบัน: <span id="statusText">กำลังโหลด...</span></label>
    <br><br>
    <button id="toggleButton">สลับสถานะ</button>
</body>
  </html>
